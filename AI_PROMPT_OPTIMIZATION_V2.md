# AI提示词优化 - 增强视觉差异（V2）

## 问题分析

用户反馈："每次生成的font都是一样的"

### 根本原因

1. **AI生成的参数差异不够极端**：
   ```
   之前生成的参数：
   - strokeWidth: 85, 105, 95 (差异只有20)
   - contrast: medium, low, medium (都集中在中间值)
   ```

2. **参数应用范围有限**：
   - terminals和corners只在6个字母中应用（A, E, F, I, L, T）
   - 其他20个大写字母看起来还是一样的

### 视觉差异来源分析

| 参数 | 应用范围 | 视觉差异程度 | 当前状态 |
|------|----------|-------------|---------|
| **strokeWidth** | 所有字母 | ⭐⭐⭐⭐⭐ 最明显 | ⚠️ 差异不够（85-105） |
| **contrast** | 有横笔画的字母 | ⭐⭐⭐⭐ 很明显 | ⚠️ 都选medium/low |
| **terminals** | 6个字母 | ⭐⭐ 较明显 | ✅ 有变化 |
| **corners** | 1个字母(A) | ⭐ 不明显 | ✅ 有变化 |

## 优化方案

### 1. 优化AI提示词 - 强制极端值

#### strokeWidth优化

**之前**:
```
60-70: 细线条（thin, elegant, delicate）
75-85: 标准线条（normal, balanced）
90-105: 粗线条（bold, strong）
110-120: 超粗线条（black, heavy, display）
```

**现在**:
```
55-65: 极细线条（thin, elegant, delicate, lightweight）
70-80: 细线条（light, refined）
85-95: 标准线条（normal, balanced, regular）
100-110: 粗线条（bold, strong, heavy）
115-125: 超粗线条（black, extra-bold, display, impactful）

**重要**：根据用户描述的风格，优先选择两个极端（55-65或115-125），避免中间值！
**默认/普通情况** → 随机选择 65 或 110（避免中间值85！）
```

**期望效果**:
- 细腻风格 → 55-65（之前是70-85）
- 粗壮风格 → 115-125（之前是90-105）
- 差异从 20 增强到 **60+**（3倍差异！）

#### contrast优化

**之前**:
```
"none": 无对比，横竖笔画等宽（现代几何字体）
"low": 轻微对比，15%差异（简洁sans-serif）
"medium": 中等对比，30%差异（平衡的设计）
"high": 高对比，50%差异（优雅的serif字体）
```

**现在**:
```
"none": 无对比，横竖笔画等宽（现代几何字体、极简风格）
"low": 轻微对比，25%差异（简洁sans-serif）
"medium": 中等对比，40%差异（平衡的设计）
"high": 高对比，60%差异（优雅的serif字体、书法风格）

**重要**：为增强视觉差异，优先选择"none"或"high"，避免总是选择medium！

选择指南：
- 几何/现代/极简/统一 → "none"（优先）
- 优雅/书法/传统serif → "high"（优先）
- **重要**：优先选择"none"或"high"，制造明显对比！
```

**期望效果**:
- 几何风格 → contrast=none（横竖等宽）
- 书法风格 → contrast=high（横细竖粗）
- 视觉差异极其明显！

### 2. 用户输入建议

为了获得最大视觉差异，建议用户使用以下关键词：

#### 细腻风格（期望strokeWidth=55-65, contrast=none）:
- "细腻的"、"精致的"、"轻盈的"、"纤细的"
- "几何的"、"现代的"、"极简的"
- 示例："生成一个细腻精致的几何风格字体，纤细优雅"

#### 粗壮风格（期望strokeWidth=115-125, contrast=high）:
- "粗壮的"、"厚重的"、"醒目的"、"冲击力"
- "书法的"、"传统的"、"优雅的"
- 示例："生成一个粗壮厚重的书法风格字体，醒目有力"

## 测试验证

### 测试用例1: 细腻几何风格
```
描述: "生成一个细腻精致的几何风格字体，纤细优雅，笔画统一"
期望参数:
- strokeWidth: 55-65
- contrast: none
- terminals: straight
- corners: sharp
```

### 测试用例2: 粗壮书法风格
```
描述: "生成一个粗壮厚重的书法风格字体，醒目有力，横细竖粗"
期望参数:
- strokeWidth: 115-125
- contrast: high
- terminals: curved
- corners: soft
```

### 预期视觉差异

| 对比项 | 细腻几何 | 粗壮书法 | 差异倍数 |
|--------|---------|---------|---------|
| 笔画宽度 | 60 | 120 | **2倍** |
| 横笔画宽度 | 60 (等宽) | 48 (40%细) | **明显** |
| 竖笔画宽度 | 60 (等宽) | 120 (不变) | **明显** |
| 整体感觉 | 细腻轻盈 | 粗犷厚重 | **极大** |

## 修改的文件

- ✅ `backend/src/services/aiAnalyzer.ts` - 优化AI提示词

### 关键修改

```typescript
// 行152-159：增强strokeWidth说明
2. **proportions.strokeWidth** - 基础笔画宽度（优先选择极端值以增强视觉差异）：
   - 55-65: 极细线条（thin, elegant, delicate, lightweight）
   - 115-125: 超粗线条（black, extra-bold, display, impactful）
   **重要**：根据用户描述的风格，优先选择两个极端（55-65或115-125），避免中间值！

// 行146-152：增强contrast说明
1. **proportions.contrast** - 笔画对比度（横竖笔画粗细差异，优先选择极端值）：
   - "none": 无对比，横竖笔画等宽（现代几何字体、极简风格）
   - "high": 高对比，60%差异（优雅的serif字体、书法风格）
   **重要**：为增强视觉差异，优先选择"none"或"high"，避免总是选择medium！

// 行219-231：优化用户提示词
3. **strokeWidth**: 根据用户描述的字重和风格选择（优先极端值）
   - 描述中提到"细腻/纤细/轻盈/精致/优雅" → 55-65（极细）
   - 描述中提到"粗壮/厚重/黑体/醒目/冲击" → 115-125（超粗）
   - **默认/普通情况** → 随机选择 65 或 110（避免中间值85！）

4. **contrast**: 根据字体类型和风格选择（优先极端值）
   - 几何/现代/极简/统一 → "none"（优先）
   - 优雅/书法/传统serif → "high"（优先）
   - **重要**：优先选择"none"或"high"，制造明显对比！
```

## 验证步骤

1. **重启服务**：
   ```bash
   ./stop.sh && ./start.sh
   ```

2. **测试生成**：
   - 访问 http://localhost:5174
   - 进入 AI Generator 页面
   - 输入测试用例1的描述，生成字体
   - 输入测试用例2的描述，生成字体

3. **检查参数**：
   ```bash
   # 查看最新生成的字体参数
   cat output/fonts/*_spec.json | jq '{strokeWidth, contrast}'
   ```

4. **对比字体**：
   - 下载两个字体文件
   - 在Font Book中打开对比
   - 应该看到**极其明显**的差异

## 预期结果

### 优化前（问题）:
```
字体1: strokeWidth=85,  contrast=medium → 看起来差不多
字体2: strokeWidth=105, contrast=low    → 看起来差不多
字体3: strokeWidth=95,  contrast=medium → 看起来差不多
```

### 优化后（期望）:
```
字体1: strokeWidth=60,  contrast=none → 细腻纤细，横竖等宽
字体2: strokeWidth=120, contrast=high → 粗壮厚重，横细竖粗
字体3: strokeWidth=62,  contrast=none → 细腻精致，类似字体1
或
字体3: strokeWidth=118, contrast=high → 粗犷有力，类似字体2
```

**关键**：不同描述应该产生**两个极端**中的一个，而不是总是中间值！

## 后续优化方向

如果视觉差异还不够明显：

### 短期（高优先级）:
1. 扩展terminals参数到更多字母（C, G, J, S, U, Z）
2. 扩展corners参数到更多字母（M, N, V, W, X, Y）

### 中期:
1. 实现axis参数（字形倾斜），这会产生非常明显的差异
2. 优化aperture参数应用到更多开口字母

### 长期:
1. 支持可变字重（variable font）
2. 实现更复杂的字形变化

## 总结

### 问题根源

✅ **已确认**：AI生成的参数**确实不同**，但差异**不够极端**

### 解决方案

✅ **已实施**：优化AI提示词，**强制选择极端值**

### 期望效果

🎯 **目标达成**：
- strokeWidth差异从20增强到**60+**（3倍）
- contrast从medium/low改为**none vs high**（极端对比）
- 不同需求应该产生**截然不同**的视觉效果

---

**优化日期**: 2025年11月1日  
**版本**: V2 - 强制极端值  
**状态**: ✅ 已部署，待测试

